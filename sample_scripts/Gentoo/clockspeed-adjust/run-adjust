#!/bin/sh
# generated by clockspeed-conf-0.4.5_0
#
# script to do the time measurements for clockspeed
# automatically - it runs forever
# based on Frank Tegtmeyer <fte at pobox.com>, based on an idea
# of Tim Goodwin

# $Header:  Exp $

exec 2>&1

if [ `id -u` -eq 0 ]; then
	echo "MUST NOT RUN AS ROOT"
	sleep 600
	exit
fi

maximum_wait=${MAXIMUM_WAIT}
sleep=${INITIAL_WAIT}
server=${SERVER_IP}

while true
do
	# wait a while
	echo Sleeping ${sleep} seconds ...
	sleep ${sleep}
	# get new measurement
	/usr/bin/sntpclock ${server} \
	| tee "/var/lib/clockspeed/adjust" \
	| /usr/bin/clockview
	[ -f /var/lib/clockspeed/atto ] && /usr/bin/clockview < "/var/lib/clockspeed/atto"
	echo '----------------------'
	# double the time
	sleep=`expr ${sleep} + ${sleep}`
	# cut the value
	[ ${sleep} -gt ${maximum_wait} ] && sleep=${maximum_wait}
done
#.

